<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Spatial Data Science - 9&nbsp; Plotting spatial data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10-part-3.html" rel="next">
<link href="./08-Large.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Plotting spatial data</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Data Science</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./00-part-1.html" class="sidebar-item-text sidebar-link">Spatial Data</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-hello.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Spaces.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coordinates</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-Geometries.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geometries</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-Spherical.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spherical Geometries</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-Attributes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Attributes and Support</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./06-part-2.html" class="sidebar-item-text sidebar-link">R for Spatial Data Science</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-Cubes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Cubes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-Introsf.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to sf and stars</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-Large.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Large data and cloud native</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-Plotting.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Plotting spatial data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./10-part-3.html" class="sidebar-item-text sidebar-link">Models for Spatial Data</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Models.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Statistical modelling of spatial data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-PointPattern.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Point Pattern Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-Interpolation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Spatial Interpolation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-Geostatistics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multivariate and Spatiotemporal Geostatistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-Areal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Proximity and Areal Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-SpatialRegression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Spatial Regression</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30-sp-raster.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Older R Spatial Packages</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./97-allcode.html" class="sidebar-item-text sidebar-link">All R code in this book</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./98-rbascis.html" class="sidebar-item-text sidebar-link">R basics</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">Index</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-transform" id="toc-sec-transform" class="nav-link active" data-scroll-target="#sec-transform"> <span class="header-section-number">9.1</span> Every plot is a projection</a>
  <ul class="collapse">
  <li><a href="#what-is-a-good-projection-for-my-data" id="toc-what-is-a-good-projection-for-my-data" class="nav-link" data-scroll-target="#what-is-a-good-projection-for-my-data">What is a good projection for my data?</a></li>
  </ul></li>
  <li><a href="#plotting-points-lines-polygons-grid-cells" id="toc-plotting-points-lines-polygons-grid-cells" class="nav-link" data-scroll-target="#plotting-points-lines-polygons-grid-cells"> <span class="header-section-number">9.2</span> Plotting points, lines, polygons, grid cells</a>
  <ul class="collapse">
  <li><a href="#colors" id="toc-colors" class="nav-link" data-scroll-target="#colors">Colors</a></li>
  <li><a href="#sec-classintervals" id="toc-sec-classintervals" class="nav-link" data-scroll-target="#sec-classintervals">Color breaks: <code>classInt</code></a></li>
  <li><a href="#sec-graticule" id="toc-sec-graticule" class="nav-link" data-scroll-target="#sec-graticule">Graticule and other navigation aids</a></li>
  </ul></li>
  <li><a href="#base-plot" id="toc-base-plot" class="nav-link" data-scroll-target="#base-plot"> <span class="header-section-number">9.3</span> Base <code>plot</code></a>
  <ul class="collapse">
  <li><a href="#adding-to-plots-with-legends" id="toc-adding-to-plots-with-legends" class="nav-link" data-scroll-target="#adding-to-plots-with-legends">Adding to plots with legends</a></li>
  <li><a href="#projections-in-base-plots" id="toc-projections-in-base-plots" class="nav-link" data-scroll-target="#projections-in-base-plots">Projections in base plots</a></li>
  <li><a href="#colors-and-coulor-breaks" id="toc-colors-and-coulor-breaks" class="nav-link" data-scroll-target="#colors-and-coulor-breaks">Colors and coulor breaks</a></li>
  </ul></li>
  <li><a href="#sec-geomsf" id="toc-sec-geomsf" class="nav-link" data-scroll-target="#sec-geomsf"> <span class="header-section-number">9.4</span> Maps with <code>ggplot2</code></a></li>
  <li><a href="#sec-tmap" id="toc-sec-tmap" class="nav-link" data-scroll-target="#sec-tmap"> <span class="header-section-number">9.5</span> Maps with <code>tmap</code></a></li>
  <li><a href="#interactive-maps-leaflet-mapview-tmap" id="toc-interactive-maps-leaflet-mapview-tmap" class="nav-link" data-scroll-target="#interactive-maps-leaflet-mapview-tmap"> <span class="header-section-number">9.6</span> Interactive maps: <code>leaflet</code>, <code>mapview</code>, <code>tmap</code></a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"> <span class="header-section-number">9.7</span> Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-plotting" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Plotting spatial data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Together with timelines, maps belong to the most powerful graphs, perhaps because we can immediately relate where we are, or have been, on the space of the plot. Two recent books on visualisation <span class="citation" data-cites="Healy Wilke">(<a href="references.html#ref-Healy" role="doc-biblioref">Healy 2018</a>; <a href="references.html#ref-Wilke" role="doc-biblioref">Wilke 2019</a>)</span> contain chapters on visualising geospatial data or maps. Here, we will not try to preach the do’s and don’ts of maps, but rather point out a number of possibilities how to do things, point out challenges along the way and ways to mitigate them.</p>
<section id="sec-transform" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="sec-transform"><span class="header-section-number">9.1</span> Every plot is a projection</h2>
<p>The world is round, but plotting devices are flat. As mentioned in <a href="02-Spaces.html#sec-projections"><span>Section&nbsp;2.2.2</span></a>, any time we visualise, in any way, the world on a flat device, we project: we convert ellipsoidal coordinates into Cartesian coordinates. This includes the cases where we think we “do nothing” (<a href="#fig-world">Figure&nbsp;<span>9.1</span></a>), left , or where we show the world “as it is”, e.g.&nbsp;as seen from space (<a href="#fig-world">Figure&nbsp;<span>9.1</span></a>, right).</p>
<div class="cell" data-fig="true">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">st_crs</span>(w) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(<span class="st">'OGC:CRS84'</span>))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(w))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sphere:</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(s2)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">as_s2_geography</span>(<span class="cn">TRUE</span>) <span class="co"># Earth</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>co <span class="ot">&lt;-</span> <span class="fu">s2_data_countries</span>()</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>oc <span class="ot">&lt;-</span> <span class="fu">s2_difference</span>(g, <span class="fu">s2_union_agg</span>(co)) <span class="co"># oceans</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">s2_buffer_cells</span>(<span class="fu">as_s2_geography</span>(<span class="st">"POINT(-30 -10)"</span>), <span class="dv">9800000</span>) <span class="co"># visible half</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">s2_intersection</span>(b, oc) <span class="co"># visible ocean</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>co <span class="ot">&lt;-</span> <span class="fu">s2_intersection</span>(b, co)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_transform</span>(<span class="fu">st_as_sfc</span>(i), <span class="st">"+proj=ortho +lat_0=-10 +lon_0=-30"</span>), <span class="at">col =</span> <span class="st">'lightblue'</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_transform</span>(<span class="fu">st_as_sfc</span>(co), <span class="st">"+proj=ortho +lat_0=-10 +lon_0=-30"</span>), <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-world" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="09-Plotting_files/figure-html/fig-world-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 9.1: Earth country boundaries; left: mapping long/lat linearly to <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> (plate carrée); right: as seen from infinite distance (orthographic)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The left plot of <a href="#fig-world">Figure&nbsp;<span>9.1</span></a> was obtained by</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(w))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and we see that this is the default projection for data with ellipsoidal coordinates, as indicated by</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_is_longlat</span>(w)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The projection taken in <a href="#fig-world">Figure&nbsp;<span>9.1</span></a>) (left is the equirectangular (or equidistant cylindrical) projection, which maps longitude and latitude linearly to the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> axis, keeping an aspect ratio of 1. Were we to do this for smaller areas not on the equator, it makes sense to choose a plot ratio such that one distance unit E-W equals one distance unit N-S on the center of the plotted area, and this is the default behaviour of the <code>plot()</code> method for unprojected <code>sf</code> or <code>stars</code> datasets, as well as the default for <code>ggplot2::geom_sf()</code> (<a href="#sec-geomsf"><span>Section&nbsp;9.4</span></a>).</p>
<p>We can also carry out this projection before plotting. Say we want to plot Germany, then after loading the (rough) country outline, we use <code>st_transform</code> to project:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>DE <span class="ot">&lt;-</span> <span class="fu">st_geometry</span>(<span class="fu">ne_countries</span>(<span class="at">country =</span> <span class="st">"germany"</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">returnclass =</span> <span class="st">"sf"</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>DE.eqc <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(DE, <span class="st">"+proj=eqc +lat_ts=51.14 +lon_0=90w"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>eqc</code> refers to the “equidistant cylindrical” projection of PROJ; the projection parameter here is <code>lat_ts</code>, the latitude of true scale (i.e., one length unit N-S equals one length unit E-W), which was here chosen as the middle of the bounding box latitudes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">mean</span>(<span class="fu">st_bbox</span>(DE)[<span class="fu">c</span>(<span class="st">"ymin"</span>, <span class="st">"ymax"</span>)]), <span class="at">digits =</span> <span class="dv">4</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 51.14</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we now plot both maps (<a href="#fig-eqc">Figure&nbsp;<span>9.2</span></a>) , they look identical up to the values along the axes: degrees for ellipsoidal (left), and metres for projected (Cartesian) coordinates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(DE, <span class="at">axes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(DE.eqc, <span class="at">axes =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-eqc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="09-Plotting_files/figure-html/fig-eqc-1.png" class="img-fluid figure-img" style="width:60.0%"></p>
<p></p><figcaption class="figure-caption">Figure 9.2: Germany in equirectangular projection: with axis units degrees (left) and metres in the equidistant cylindrical projection (right)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<section id="what-is-a-good-projection-for-my-data" class="level3">
<h3 class="anchored" data-anchor-id="what-is-a-good-projection-for-my-data">What is a good projection for my data?</h3>
<p>There is unfortunately no silver bullet here. Projections that maintain all distances do not exist; only globes do. The most used projections try to preserve:</p>
<ul>
<li>areas (equal area)</li>
<li>directions (conformal, e.g.&nbsp;Mercator)</li>
<li>some properties of distances (e.g.&nbsp;equirectangular preserves distances along meridians, azimuthal equidistant preserves distances to a central point)</li>
</ul>
<p>or some compromise of these. Parameters of projections decide what is shown in the center of a map and what on the fringes, which areas are up and which are down, and which areas are most enlarged. All these choices are in the end political decisions.</p>
<p>It is often entertaining and at times educational to play around with the different projections and understand their consequences. When the primary purpose of the map however is not to entertain or educate projection varieties, it may be preferable to choose a well-known or less surprising projection, and move the discussion which projection should be preferred to a decision process on its own.</p>
</section>
</section>
<section id="plotting-points-lines-polygons-grid-cells" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="plotting-points-lines-polygons-grid-cells"><span class="header-section-number">9.2</span> Plotting points, lines, polygons, grid cells</h2>
<p>Since maps are just a special form of plots of statistical data, the usual rules hold. Frequently occurring challenges include:</p>
<ul>
<li>polygons may be very small, and vanish when plotted</li>
<li>depending on the data, polygons for different features may well overlap, and be visible only partially; using transparent fill colours may help identify them</li>
<li>when points are plotted with symbols, they may easily overlap and be hidden; density maps (<a href="13-PointPattern.html"><span>Chapter&nbsp;11</span></a>) may be more helpful</li>
<li>lines may be hard to read when coloured and may overlap regardless line width</li>
</ul>
<section id="colors" class="level3">
<h3 class="anchored" data-anchor-id="colors">Colors</h3>
<p>When plotting polygons filled with colours, one has the choice to plot polygon boundaries, or to suppress these. If polygon boundaries draw too much attention, an alternative is to colour them in a grey tone, or another colour that doesn’t interfere with the fill colours. When suppressing boundaries entirely, polygons with (nearly) identical colours will no longer be visually distinguishable. If the property indicating the fill colour is constant over the region, such as land cover type, then this is not a problem but if the property is an aggregation, the region over which it was aggregated gets lost, and by that the proper interpretation: especially for extensive variables, e.g.&nbsp;the amount of people living in a polygon, this strongly misleads. But even with polygon boundaries, using filled polygons for such variables may not be a good idea.</p>
<p>The use of continuous colour scales that have no noticeable colour breaks for continuously varying variables may look attractive, but is often more fancy than useful:</p>
<ul>
<li>it impracticable to match a colour on the map with a legend value</li>
<li>colours ramps often stretch non-linearly over the value range, making it hard to convey magnitude</li>
</ul>
<p>Only for cases where the identification of values is less important than the continuity of the map, such as the colouring of a high resolution digital terrain model, it does serve its goal. Good colours scales and palettes are e.g.&nbsp;found in functions <code>hcl.colors</code> or <code>palette.colors</code>, and in packages <code>RColorBrewer</code> <span class="citation" data-cites="R-RColorBrewer">(<a href="references.html#ref-R-RColorBrewer" role="doc-biblioref">Neuwirth 2022</a>)</span>, <code>viridis</code> <span class="citation" data-cites="R-viridis">(<a href="references.html#ref-R-viridis" role="doc-biblioref">Garnier 2021</a>)</span> or <code>colorspace</code> <span class="citation" data-cites="R-colorspace colorspace">(<a href="references.html#ref-R-colorspace" role="doc-biblioref">Ihaka et al. 2022</a>; <a href="references.html#ref-colorspace" role="doc-biblioref">Zeileis et al. 2020</a>)</span>.</p>
</section>
<section id="sec-classintervals" class="level3">
<h3 class="anchored" data-anchor-id="sec-classintervals">Color breaks: <code>classInt</code></h3>
<p>When plotting continuous geometry attributes using a limited set of colours (or symbols), classes need to be made from the data. R package <code>classInt</code> <span class="citation" data-cites="R-classInt">(<a href="references.html#ref-R-classInt" role="doc-biblioref">Bivand 2022</a>)</span> provides a number of methods to do so. The default method is “quantile”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(classInt)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(1) needed ?</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>(cI <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(r))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># style: quantile</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   one of 1.49e+10 possible partitions of this variable into 8 classes</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#    [-4.54,-1.18)   [-1.18,-0.737)  [-0.737,-0.337) </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#               13               12               13 </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># [-0.337,-0.0583)  [-0.0583,0.345)    [0.345,0.583) </span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#               12               12               13 </span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#    [0.583,0.981)     [0.981,2.08] </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#               12               13</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>cI<span class="sc">$</span>brks</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] -4.5383 -1.1810 -0.7374 -0.3373 -0.0583  0.3450  0.5829</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># [8]  0.9807  2.0836</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>it takes argument <code>n</code> for the number of intervals, and a <code>style</code> that can be one of “fixed”, “sd”, “equal”, “pretty”, “quantile”, “kmeans”, “hclust”, “bclust”, “fisher” or “jenks”. Style “pretty” may not obey <code>n</code>; if <code>n</code> is missing, ‘nclass.Sturges’ is used; two other methods are available for choosing <code>n</code> automatically. If the number of observations is greater than 3000, a 10% sample is used to create the breaks for “fisher” and “jenks”.</p>
</section>
<section id="sec-graticule" class="level3">
<h3 class="anchored" data-anchor-id="sec-graticule">Graticule and other navigation aids</h3>
<p>A graticule is a network of lines on a map that follow constant latitude or longitude. On <a href="01-hello.html#fig-first-map">Figure&nbsp;<span>1.1</span></a> a graticule is drawn in grey, on <a href="01-hello.html#fig-firstgather">Figure&nbsp;<span>1.2</span></a> in white. Graticules are often drawn in maps to give reference where something is. In our first map in <a href="01-hello.html#fig-first-map">Figure&nbsp;<span>1.1</span></a> we can read that the area plotted is near 35<span class="math inline">\(^o\)</span> North and 80<span class="math inline">\(^o\)</span> West. Had we plotted the lines in the projected coordinate system, they would have been straight and their actual numbers would not have been very informative, apart from giving an interpretation of size or distances when the unit is known, and familiar to the map reader. Graticules, by that, also shed light on which projection was used: equirectangular or Mercator projections have straight vertical and horizontal lines, conic projections have straight but diverging meridians, equal area may have curved meridians.</p>
<p>The real navigation aid on <a href="#fig-world">Figure&nbsp;<span>9.1</span></a> and most other maps are geographical features like the state outline, country outlines, coast lines, rivers, roads, railways and so on. If these are added sparsely and sufficiently, a graticule can as well be omitted. In such cases, maps look good without axes, tics, and labels, leaving up a lot of plotting space to be filled with actual map data.</p>
</section>
</section>
<section id="base-plot" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="base-plot"><span class="header-section-number">9.3</span> Base <code>plot</code></h2>
<p>The <code>plot</code> method for <code>sf</code> and <code>stars</code> objects try to make quick, useful, exploratory plots; for higher quality plots and more configurability, alternatives with more control and/or better defaults are offered for instance by packages <code>ggplot2</code> <span class="citation" data-cites="R-ggplot2">(<a href="references.html#ref-R-ggplot2" role="doc-biblioref">Wickham et al. 2022</a>)</span>, <code>tmap</code> <span class="citation" data-cites="R-tmap tmap">(<a href="references.html#ref-R-tmap" role="doc-biblioref">Tennekes 2022</a>, <a href="references.html#ref-tmap" role="doc-biblioref">2018</a>)</span> or <code>mapsf</code> <span class="citation" data-cites="R-mapsf">(<a href="references.html#ref-R-mapsf" role="doc-biblioref">Giraud 2022</a>)</span>.</p>
<p>By default, the plot method tries to plot “all” it is given. This means that:</p>
<ul>
<li>given a geometry only (<code>sfc</code>), the geometry is plotted, without colours</li>
<li>given a geometry and an attribute, the geometry is coloured according to the values of the attribute, using a qualitative colour scale for <code>factor</code> or <code>logical</code> attributes and a continuous scale otherwise</li>
<li>given multiple attributes, multiple maps are plotted, each with a colour scale but a legend is omitted by default, as colour assignment is done on a per sub-map basis</li>
<li>for <code>stars</code> objects with multiple attributes, only the first attribute is plotted; for three-dimensional raster cubes, all slices over the third dimension are plotted</li>
</ul>
<section id="adding-to-plots-with-legends" class="level3">
<h3 class="anchored" data-anchor-id="adding-to-plots-with-legends">Adding to plots with legends</h3>
<p>The <code>plot</code> methods for <code>stars</code> and <code>sf</code> objects may show a colour key on one of the sides (e.g., <a href="01-hello.html#fig-first-map">Figure&nbsp;<span>1.1</span></a>) . To do this with <code>base::plot</code>, the plot region is split in two and two plots are created: one with the map, and one with the legend. By default, the <code>plot</code> function resets the graphics device (using <code>layout(matrix(1))</code> so that subsequent plots are not hindered by the device being split in two. If one wants to <em>add</em> to an existing plot having a coulor legend, this is however what is needed, and resetting the plotting device needs to be prevented by setting argument <code>reset = FALSE</code>, and use <code>add = TRUE</code> in a subsequent call to <code>plot</code>, an example is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>nc <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="fu">system.file</span>(<span class="st">"gpkg/nc.gpkg"</span>, <span class="at">package =</span> <span class="st">"sf"</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nc[<span class="st">"BIR74"</span>], <span class="at">reset =</span> <span class="cn">FALSE</span>, <span class="at">key.pos =</span> <span class="dv">4</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_buffer</span>(nc[<span class="dv">1</span>,<span class="dv">1</span>], units<span class="sc">::</span><span class="fu">set_units</span>(<span class="dv">10</span>, km)), <span class="at">col =</span> <span class="st">'NA'</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">'red'</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-figreset" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="09-Plotting_files/figure-html/fig-figreset-1.png" style="height:80.0%" width="672" class="figure-img"></p>
<p></p><figcaption class="figure-caption">Figure 9.3: Annotating base plots that have a legend</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>which is shown in <a href="#fig-figreset">Figure&nbsp;<span>9.3</span></a> . Annotating <code>stars</code> plots can be done in the same way when a <em>single</em> stars layer is shown. Annotating <code>stars</code> plots with multiple cube slices can be done by adding a “hook” function that will be called on every slice shown, as in</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">read_stars</span>(<span class="fu">system.file</span>(<span class="st">"tif/L7_ETMs.tif"</span>, <span class="at">package =</span> <span class="st">"stars"</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>circ <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(r) <span class="sc">|&gt;</span> <span class="fu">st_as_sfc</span>() <span class="sc">|&gt;</span> <span class="fu">st_sample</span>(<span class="dv">5</span>) <span class="sc">|&gt;</span> <span class="fu">st_buffer</span>(<span class="dv">300</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>hook <span class="ot">&lt;-</span> <span class="cf">function</span>() <span class="fu">plot</span>(circ, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">'yellow'</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r, <span class="at">hook =</span> hook, <span class="at">key.pos =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-starshook" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="09-Plotting_files/figure-html/fig-starshook-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 9.4: annotated multi-slice stars plot</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>and as shown in <a href="#fig-starshook">Figure&nbsp;<span>9.4</span></a> .</p>
<p>Base plot methods have access to the resolution of the screen device and hence the base plot method for <code>stars</code> and <code>stars_proxy</code> object will downsample dense rasters and only plot pixels at a density that makes sense for the device available.</p>
</section>
<section id="projections-in-base-plots" class="level3">
<h3 class="anchored" data-anchor-id="projections-in-base-plots">Projections in base plots</h3>
<p>The base <code>plot</code> method plots data with ellipsoidal coordinates using the equirectangular projection, using a latitude parameter equal to the middle latitude of the data bounding box (<a href="#fig-eqc">Figure&nbsp;<span>9.2</span></a>). To control this parameter, either a projection to another equirectangular can be applied before plotting, or the parameter <code>asp</code> can be set to override, e.g.&nbsp;<code>asp=1</code> would lead to plate carrée (<a href="#fig-world">Figure&nbsp;<span>9.1</span></a>) left . Subsequent plots need to be in the same coordinate reference system in order to make sense with overplotting, this is not being checked.</p>
</section>
<section id="colors-and-coulor-breaks" class="level3">
<h3 class="anchored" data-anchor-id="colors-and-coulor-breaks">Colors and coulor breaks</h3>
<p>In base plots, <code>nbreaks</code> can be used to set the number of coulor breaks, and <code>breaks</code> either to the numeric vector with actual breaks, or to a value for the <code>style</code> argument in <code>classInt::classIntervals</code>.</p>
</section>
</section>
<section id="sec-geomsf" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="sec-geomsf"><span class="header-section-number">9.4</span> Maps with <code>ggplot2</code></h2>
<p>Package <code>ggplot2</code> <span class="citation" data-cites="R-ggplot2 ggplot2">(<a href="references.html#ref-R-ggplot2" role="doc-biblioref">Wickham et al. 2022</a>; <a href="references.html#ref-ggplot2" role="doc-biblioref">Wickham 2016</a>)</span> can create more complex an nicer looking graphs; it has a geometry <code>geom_sf</code> that was developed in conjunction with the development of <code>sf</code>, and helps creating beautiful maps; an introduction to this is found in <span class="citation" data-cites="moreno">Moreno and Basille (<a href="references.html#ref-moreno" role="doc-biblioref">2018</a>)</span>, a first example is shown in <a href="01-hello.html#fig-firstgather">Figure&nbsp;<span>1.2</span></a> . The code used for this plot is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(tidyverse))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>nc<span class="fl">.32119</span> <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(nc, <span class="dv">32119</span>) </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>year_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SID74"</span> <span class="ot">=</span> <span class="st">"1974 - 1978"</span>, <span class="st">"SID79"</span> <span class="ot">=</span> <span class="st">"1979 - 1984"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>nc<span class="fl">.32119</span> <span class="sc">|&gt;</span> <span class="fu">select</span>(SID74, SID79) <span class="sc">|&gt;</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"SID"</span>)) <span class="ot">-&gt;</span> nc_longer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> nc_longer, <span class="fu">aes</span>(<span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">name =</span> year_labels)) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">34</span><span class="sc">:</span><span class="dv">36</span>) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">sf.colors</span>(<span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"white"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>where we see that two attributes had to be stacked (<code>pivot_longer</code>) before plotting them as facets: this is the idea of “tidy” data, and the <code>pivot_longer</code> method for <code>sf</code> objects automatically stacks the geometry column too.</p>
<p>Because <code>ggplot2</code> creates graphics <em>objects</em> before plotting them, it can control the coordinate reference system of all elements involved, and will transform or convert all subsequent objects to the coordinate reference system of the first. It will also draw a graticule for the (default) thin white lines on a grey background, and uses a datum (by default: WGS84) for this. <code>geom_sf()</code> can be combined with other geoms, for instance to allow for annotating plots.</p>
<p>For package <code>stars</code>, a <code>geom_stars</code> has, at the moment of writing this, rather limited scope: it uses <code>geom_sf</code> for map layout and vector data cubes, and adds <code>geom_raster</code> for regular rasters and <code>geom_rect</code> for rectilinear rasters. It downsamples if the user specifies a downsampling rate, but has no access to the screen dimensions to automatically choose a downsampling rate. This may be just enough, for instance figure <a href="#fig-ggplotstars">Figure&nbsp;<span>9.5</span></a> is created by the following commands:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">read_stars</span>(<span class="fu">system.file</span>(<span class="st">"tif/L7_ETMs.tif"</span>, <span class="at">package =</span> <span class="st">"stars"</span>))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_stars</span>(<span class="at">data =</span> r) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_wrap</span>(<span class="sc">~</span>band) <span class="sc">+</span> <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_viridis_c</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ggplotstars" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="09-Plotting_files/figure-html/fig-ggplotstars-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 9.5: Simple raster plot with ggplot2</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>More elaborate <code>ggplot2</code>-based plots with <code>stars</code> objects may be obtained using package <code>ggspatial</code> <span class="citation" data-cites="R-ggspatial">(<a href="references.html#ref-R-ggspatial" role="doc-biblioref">Dunnington 2022</a>)</span>. Non-compatible but nevertheless <code>ggplot2</code>-style plots can be created with <code>tmap</code>, a package dedicated to creating high quality maps.</p>
<p>When combining several feature sets with varying coordinate reference systems, using <code>geom_sf</code>, all sets are transformed to the reference system of the first set. To get further control over the “base” coordinate reference system, <code>coord_sf</code> can be used. This allows for instance working in a projected system, while combining graphics elements that are <em>not</em> <code>sf</code> objects but regular <code>data.frame</code>s with ellipsoidal coordinates associated to WGS84. A twitter thread by Claus Wilke illustrating this is found <a href="https://twitter.com/ClausWilke/status/1275938314055561216">here</a>.</p>
</section>
<section id="sec-tmap" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="sec-tmap"><span class="header-section-number">9.5</span> Maps with <code>tmap</code></h2>
<p>Package <code>tmap</code> <span class="citation" data-cites="R-tmap tmap">(<a href="references.html#ref-R-tmap" role="doc-biblioref">Tennekes 2022</a>, <a href="references.html#ref-tmap" role="doc-biblioref">2018</a>)</span> takes a fresh look on plotting spatial data in R; it resembles <code>ggplot2</code> in the sense that it composes graphics objects before printing, by building on the <code>grid</code> package, and by concatenating map elements with a <code>+</code> between them, but otherwise it is entirely independent from, and incompatible with, <code>ggplot2</code>. It has a number of options that allow for highly professional looking maps, and many defaults have been carefully chosen. To recreate <a href="01-hello.html#fig-firstgather">Figure&nbsp;<span>1.2</span></a> , for instance, we use</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-tmapnc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="09-Plotting_files/figure-html/fig-tmapnc-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figure 9.6: tmap: using <code>tm_polygons()</code> with two attribute names</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>to recreate <a href="#fig-tmapnc">Figure&nbsp;<span>9.6</span></a> and</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>nc_longer <span class="ot">&lt;-</span> nc<span class="fl">.32119</span> <span class="sc">|&gt;</span> <span class="fu">select</span>(SID74, SID79) <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"SID"</span>), <span class="at">values_to =</span> <span class="st">"SID"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(nc_longer) <span class="sc">+</span> <span class="fu">tm_polygons</span>(<span class="st">"SID"</span>) <span class="sc">+</span> <span class="fu">tm_facets</span>(<span class="at">by =</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-tmapnc2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="09-Plotting_files/figure-html/fig-tmapnc2-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figure 9.7: tmap: using <code>tm_facets()</code> on a long table</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>to create <a href="#fig-tmapnc2">Figure&nbsp;<span>9.7</span></a> .</p>
<p>Package <code>tmap</code> also has support for <code>stars</code> objects, an example created with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(r) <span class="sc">+</span> <span class="fu">tm_raster</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-tmapstars" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="09-Plotting_files/figure-html/fig-tmapstars-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figure 9.8: simple raster plot with tmap</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>is shown in <a href="#fig-tmapstars">Figure&nbsp;<span>9.8</span></a>. More examples of the use of <strong>tmap</strong> are given in <a href="17-Areal.html"><span>Chapter&nbsp;14</span></a>.</p>
</section>
<section id="interactive-maps-leaflet-mapview-tmap" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="interactive-maps-leaflet-mapview-tmap"><span class="header-section-number">9.6</span> Interactive maps: <code>leaflet</code>, <code>mapview</code>, <code>tmap</code></h2>
<p>Interactive maps as shown in <a href="01-hello.html#fig-mapviewfigure">Figure&nbsp;<span>1.3</span></a> can be created with R packages <code>leaflet</code>, <code>mapview</code> or <code>tmap</code>. <code>mapview</code> adds a number of capabilities to <code>leaflet</code> including a map legend, configurable pop-up windows when clicking features, support for raster data, and scalable maps with very large feature sets using the FlatGeobuf file format, as well as facet maps that react synchronously to zoom and pan actions. Package <code>tmap</code> has the nice option that after giving</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"view"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>all usual <code>tmap</code> commands are applied to an interactive html/leaflet widget, whereas after</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>again all output is sent to R own static graphics device.</p>
</section>
<section id="exercises" class="level2" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="exercises"><span class="header-section-number">9.7</span> Exercises</h2>
<ol type="1">
<li>For the countries Indonesia and Canada, create individual plots using equirectangular, orthographic, and Lambert equal area projections, while choosing projection parameters sensible for the area.</li>
<li>Recreate the plot in <a href="#fig-figreset">Figure&nbsp;<span>9.3</span></a> with <code>ggplot2</code> and with <code>tmap</code>.</li>
<li>Recreate the plot in <a href="#fig-tmapstars">Figure&nbsp;<span>9.8</span></a> using the <code>viridis</code> colour ramp.</li>
<li>View the interactive plot in <a href="#fig-tmapstars">Figure&nbsp;<span>9.8</span></a> using the “view” (interactive) mode of <code>tmap</code>, and explore which interactions are possible; also explore adding <code>+ tm_facets(as.layers=TRUE)</code> and try switching layers on and off.</li>
</ol>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-R-classInt" class="csl-entry" role="doc-biblioentry">
Bivand, Roger. 2022. <em>classInt: Choose Univariate Class Intervals</em>. <a href="https://CRAN.R-project.org/package=classInt">https://CRAN.R-project.org/package=classInt</a>.
</div>
<div id="ref-R-ggspatial" class="csl-entry" role="doc-biblioentry">
Dunnington, Dewey. 2022. <em>Ggspatial: Spatial Data Framework for Ggplot2</em>. <a href="https://CRAN.R-project.org/package=ggspatial">https://CRAN.R-project.org/package=ggspatial</a>.
</div>
<div id="ref-R-viridis" class="csl-entry" role="doc-biblioentry">
Garnier, Simon. 2021. <em>Viridis: Colorblind-Friendly Color Maps for r</em>. <a href="https://CRAN.R-project.org/package=viridis">https://CRAN.R-project.org/package=viridis</a>.
</div>
<div id="ref-R-mapsf" class="csl-entry" role="doc-biblioentry">
Giraud, Timothée. 2022. <em>Mapsf: Thematic Cartography</em>. <a href="https://CRAN.R-project.org/package=mapsf">https://CRAN.R-project.org/package=mapsf</a>.
</div>
<div id="ref-Healy" class="csl-entry" role="doc-biblioentry">
Healy, Kieran. 2018. <em>Data Visualization, a Practical Introduction</em>. Princeton University Press. <a href="http://socviz.co/index.html">http://socviz.co/index.html</a>.
</div>
<div id="ref-R-colorspace" class="csl-entry" role="doc-biblioentry">
Ihaka, Ross, Paul Murrell, Kurt Hornik, Jason C. Fisher, Reto Stauffer, Claus O. Wilke, Claire D. McWhite, and Achim Zeileis. 2022. <em>Colorspace: A Toolbox for Manipulating and Assessing Colors and Palettes</em>. <a href="https://CRAN.R-project.org/package=colorspace">https://CRAN.R-project.org/package=colorspace</a>.
</div>
<div id="ref-moreno" class="csl-entry" role="doc-biblioentry">
Moreno, Mel, and Mathieu Basille. 2018. <em>Drawing Beautiful Maps Programmatically with r, Sf and Ggplot2 — Part 1: Basics</em>. <a href="https://www.r-spatial.org/r/2018/10/25/ggplot2-sf.html">https://www.r-spatial.org/r/2018/10/25/ggplot2-sf.html</a>.
</div>
<div id="ref-R-RColorBrewer" class="csl-entry" role="doc-biblioentry">
Neuwirth, Erich. 2022. <em>RColorBrewer: ColorBrewer Palettes</em>. <a href="https://CRAN.R-project.org/package=RColorBrewer">https://CRAN.R-project.org/package=RColorBrewer</a>.
</div>
<div id="ref-tmap" class="csl-entry" role="doc-biblioentry">
Tennekes, Martijn. 2018. <span>“<span class="nocase">tmap</span>: Thematic Maps in <span>R</span>.”</span> <em>Journal of Statistical Software</em> 84 (6): 1–39. <a href="https://doi.org/10.18637/jss.v084.i06">https://doi.org/10.18637/jss.v084.i06</a>.
</div>
<div id="ref-R-tmap" class="csl-entry" role="doc-biblioentry">
———. 2022. <em>Tmap: Thematic Maps</em>. <a href="https://github.com/r-tmap/tmap">https://github.com/r-tmap/tmap</a>.
</div>
<div id="ref-ggplot2" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer.
</div>
<div id="ref-R-ggplot2" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2022. <em>Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics</em>. <a href="https://CRAN.R-project.org/package=ggplot2">https://CRAN.R-project.org/package=ggplot2</a>.
</div>
<div id="ref-Wilke" class="csl-entry" role="doc-biblioentry">
Wilke, Claus O. 2019. <em>Fundamentals of Data Visualization</em>. O’Reilly Media, Inc. <a href="https://serialmentor.com/dataviz/">https://serialmentor.com/dataviz/</a>.
</div>
<div id="ref-colorspace" class="csl-entry" role="doc-biblioentry">
Zeileis, Achim, Jason C. Fisher, Kurt Hornik, Ross Ihaka, Claire D. McWhite, Paul Murrell, Reto Stauffer, and Claus O. Wilke. 2020. <span>“<span class="nocase">colorspace</span>: A Toolbox for Manipulating and Assessing Colors and Palettes.”</span> <em>Journal of Statistical Software</em> 96 (1): 1–49. <a href="https://doi.org/10.18637/jss.v096.i01">https://doi.org/10.18637/jss.v096.i01</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./08-Large.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Large data and cloud native</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./10-part-3.html" class="pagination-link">
        <span class="nav-page-text">Models for Spatial Data</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>