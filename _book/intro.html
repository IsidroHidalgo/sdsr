<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Getting Started | Spatial Data Science</title>
  <meta name="description" content="description_xx" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Getting Started | Spatial Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="description_xx" />
  <meta name="github-repo" content="edzer/sdsr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Getting Started | Spatial Data Science" />
  
  <meta name="twitter:description" content="description_xx" />
  

<meta name="author" content="Edzer Pebesma, Roger Bivand" />


<meta name="date" content="2021-05-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="cs.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<script src="libs/FlatGeoBuf-3.3.3/fgb.js"></script>
<script src="libs/FlatGeoBuf-3.3.3/flatgeobuf-geojson.min.js"></script>
<script src="libs/chromajs-2.1.0/chroma.min.js"></script>
<link id="nc_32119-BIR74-1-attachment" rel="attachment" href="libs/nc_32119-BIR74-0.0.1/nc_32119-BIR74_layer.fgb"/>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    // close the dropdown menu when an option is clicked
    $("#allCodeButton").dropdown("toggle");
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    // close the dropdown menu when an option is clicked
    $("#allCodeButton").dropdown("toggle");
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // if code block has been labeled with class `fold-show`, show the code on init!
    var classList = $(this).attr('class').split(/\s+/);
    for (var i = 0; i < classList.length; i++) {
    if (classList[i] === 'fold-show') {
        show = true;
      }
    }

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // hack: return show to false, otherwise all next codeBlocks will be shown!
    show = false;

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn {
  margin-bottom: 4px;
}

.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}

.open > .dropdown-menu {
    display: block;
    color: #ffffff;
    background-color: #ffffff;
    background-image: none;
    border-color: #92897e;
}

.dropdown-menu > li > a {
  display: block;
  padding: 3px 20px;
  clear: both;
  font-weight: 400;
  line-height: 1.42857143;
  color: #000000;
  white-space: nowrap;
}

.dropdown-menu > li > a:hover,
.dropdown-menu > li > a:focus {
  color: #ffffff;
  text-decoration: none;
  background-color: #e95420;
}

.dropdown-menu > .active > a,
.dropdown-menu > .active > a:hover,
.dropdown-menu > .active > a:focus {
  color: #ffffff;
  text-decoration: none;
  background-color: #e95420;
  outline: 0;
}
.dropdown-menu > .disabled > a,
.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  color: #aea79f;
}

.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  text-decoration: none;
  cursor: not-allowed;
  background-color: transparent;
  background-image: none;
  filter: progid:DXImageTransform.Microsoft.gradient(enabled = false);
}

.btn {
  display: inline-block;
  margin-bottom: 1;
  font-weight: normal;
  text-align: center;
  white-space: nowrap;
  vertical-align: middle;
  -ms-touch-action: manipulation;
      touch-action: manipulation;
  cursor: pointer;
  background-image: none;
  border: 1px solid transparent;
  padding: 4px 8px;
  font-size: 14px;
  line-height: 1.42857143;
  border-radius: 4px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.btn:focus,
.btn:active:focus,
.btn.active:focus,
.btn.focus,
.btn:active.focus,
.btn.active.focus {
  outline: 5px auto -webkit-focus-ring-color;
  outline-offset: -2px;
}
.btn:hover,
.btn:focus,
.btn.focus {
  color: #ffffff;
  text-decoration: none;
}
.btn:active,
.btn.active {
  background-image: none;
  outline: 0;
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn.disabled,
.btn[disabled],
fieldset[disabled] .btn {
  cursor: not-allowed;
  filter: alpha(opacity=65);
  opacity: 0.65;
  box-shadow: none;
}
a.btn.disabled,
fieldset[disabled] a.btn {
  pointer-events: none;
}
.btn-default {
  color: #ffffff;
  background-color: #aea79f; #important
  border-color: #aea79f;
}

.btn-default:focus,
.btn-default.focus {
  color: #ffffff;
  background-color: #978e83;
  border-color: #6f675e;
}

.btn-default:hover {
  color: #ffffff;
  background-color: #978e83;
  border-color: #92897e;
}
.btn-default:active,
.btn-default.active,
.btn-group > .btn:not(:first-child):not(:last-child):not(.dropdown-toggle) {
  border-radius: 0;
}
.btn-group > .btn:first-child {
  margin-left: 0;
}
.btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}
.btn-group > .btn:last-child:not(:first-child),
.btn-group > .dropdown-toggle:not(:first-child) {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group > .btn-group {
  float: left;
}
.btn-group > .btn-group:not(:first-child):not(:last-child) > .btn {
  border-radius: 0;
}
.btn-group > .btn-group:first-child:not(:last-child) > .btn:last-child,
.btn-group > .btn-group:first-child:not(:last-child) > .dropdown-toggle {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}
.btn-group > .btn-group:last-child:not(:first-child) > .btn:first-child {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group .dropdown-toggle:active,
.btn-group.open .dropdown-toggle {
  outline: 0;
}
.btn-group > .btn + .dropdown-toggle {
  padding-right: 8px;
  padding-left: 8px;
}
.btn-group > .btn-lg + .dropdown-toggle {
  padding-right: 12px;
  padding-left: 12px;
}
.btn-group.open .dropdown-toggle {
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn-group.open .dropdown-toggle.btn-link {
  box-shadow: none;
}

</style>
<script>
var str = '<div class="btn-group pull-right" style="position: fixed; right: 50px; top: 10px; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" id="allCodeButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>';
document.write(str);
</script>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Spatial Data</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-first-map"><i class="fa fa-check"></i><b>1.1</b> A first map</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#coordinate-reference-systems"><i class="fa fa-check"></i><b>1.2</b> Coordinate reference systems</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#rasterize"><i class="fa fa-check"></i><b>1.3</b> Raster and vector data</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#raster-types"><i class="fa fa-check"></i><b>1.4</b> Raster types</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#time-series-arrays-data-cubes"><i class="fa fa-check"></i><b>1.5</b> Time series, arrays, data cubes</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#support"><i class="fa fa-check"></i><b>1.6</b> Support</a></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#spatial-data-science-software"><i class="fa fa-check"></i><b>1.7</b> Spatial data science software</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cs.html"><a href="cs.html"><i class="fa fa-check"></i><b>2</b> Coordinates</a><ul>
<li class="chapter" data-level="2.1" data-path="cs.html"><a href="cs.html#units"><i class="fa fa-check"></i><b>2.1</b> Quantities, units, datum</a></li>
<li class="chapter" data-level="2.2" data-path="cs.html"><a href="cs.html#ellipsoidal-coordinates"><i class="fa fa-check"></i><b>2.2</b> Ellipsoidal coordinates</a></li>
<li class="chapter" data-level="2.3" data-path="cs.html"><a href="cs.html#crs"><i class="fa fa-check"></i><b>2.3</b> Coordinate Reference Systems</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#proj"><i class="fa fa-check"></i><b>2.4</b> PROJ and mapping accuracy</a></li>
<li class="chapter" data-level="2.5" data-path="cs.html"><a href="cs.html#wkt2"><i class="fa fa-check"></i><b>2.5</b> WKT-2</a></li>
<li class="chapter" data-level="2.6" data-path="cs.html"><a href="cs.html#exercises-1"><i class="fa fa-check"></i><b>2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="geometries.html"><a href="geometries.html"><i class="fa fa-check"></i><b>3</b> Geometries</a><ul>
<li class="chapter" data-level="3.1" data-path="geometries.html"><a href="geometries.html#simplefeatures"><i class="fa fa-check"></i><b>3.1</b> Simple feature geometries</a></li>
<li class="chapter" data-level="3.2" data-path="geometries.html"><a href="geometries.html#opgeom"><i class="fa fa-check"></i><b>3.2</b> Operations on geometries</a></li>
<li class="chapter" data-level="3.3" data-path="geometries.html"><a href="geometries.html#precision"><i class="fa fa-check"></i><b>3.3</b> Precision</a></li>
<li class="chapter" data-level="3.4" data-path="geometries.html"><a href="geometries.html#coverages"><i class="fa fa-check"></i><b>3.4</b> Coverages: tessellations and rasters</a></li>
<li class="chapter" data-level="3.5" data-path="geometries.html"><a href="geometries.html#networks"><i class="fa fa-check"></i><b>3.5</b> Networks</a></li>
<li class="chapter" data-level="3.6" data-path="geometries.html"><a href="geometries.html#exercises-2"><i class="fa fa-check"></i><b>3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spherical.html"><a href="spherical.html"><i class="fa fa-check"></i><b>4</b> Spherical Geometries</a><ul>
<li class="chapter" data-level="4.1" data-path="spherical.html"><a href="spherical.html#straight-lines"><i class="fa fa-check"></i><b>4.1</b> Straight lines</a></li>
<li class="chapter" data-level="4.2" data-path="spherical.html"><a href="spherical.html#ring-direction"><i class="fa fa-check"></i><b>4.2</b> Ring direction</a></li>
<li class="chapter" data-level="4.3" data-path="spherical.html"><a href="spherical.html#full-polygon"><i class="fa fa-check"></i><b>4.3</b> Full polygon</a></li>
<li class="chapter" data-level="4.4" data-path="spherical.html"><a href="spherical.html#bounding-box-rectangle-and-cap"><i class="fa fa-check"></i><b>4.4</b> Bounding box, rectangle, and cap</a></li>
<li class="chapter" data-level="4.5" data-path="spherical.html"><a href="spherical.html#validity-on-the-sphere"><i class="fa fa-check"></i><b>4.5</b> Validity on the sphere</a></li>
<li class="chapter" data-level="4.6" data-path="spherical.html"><a href="spherical.html#exercises-3"><i class="fa fa-check"></i><b>4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="featureattributes.html"><a href="featureattributes.html"><i class="fa fa-check"></i><b>5</b> Attributes and Support</a><ul>
<li class="chapter" data-level="5.1" data-path="featureattributes.html"><a href="featureattributes.html#agr"><i class="fa fa-check"></i><b>5.1</b> Attribute-geometry relationships and support</a></li>
<li class="chapter" data-level="5.2" data-path="featureattributes.html"><a href="featureattributes.html#aggregating-and-summarising"><i class="fa fa-check"></i><b>5.2</b> Aggregating and Summarising</a></li>
<li class="chapter" data-level="5.3" data-path="featureattributes.html"><a href="featureattributes.html#area-weighted"><i class="fa fa-check"></i><b>5.3</b> Area-weighted interpolation</a></li>
<li class="chapter" data-level="5.4" data-path="featureattributes.html"><a href="featureattributes.html#updownscaling"><i class="fa fa-check"></i><b>5.4</b> Up- and Downscaling</a></li>
<li class="chapter" data-level="5.5" data-path="featureattributes.html"><a href="featureattributes.html#exercises-4"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="datacube.html"><a href="datacube.html"><i class="fa fa-check"></i><b>6</b> Data Cubes</a><ul>
<li class="chapter" data-level="6.1" data-path="datacube.html"><a href="datacube.html#a-four-dimensional-data-cube"><i class="fa fa-check"></i><b>6.1</b> A four-dimensional data cube</a></li>
<li class="chapter" data-level="6.2" data-path="datacube.html"><a href="datacube.html#dimensions-attributes-and-support"><i class="fa fa-check"></i><b>6.2</b> Dimensions, attributes, and support</a></li>
<li class="chapter" data-level="6.3" data-path="datacube.html"><a href="datacube.html#dcoperations"><i class="fa fa-check"></i><b>6.3</b> Operations on data cubes</a></li>
<li class="chapter" data-level="6.4" data-path="datacube.html"><a href="datacube.html#vectordatacubes"><i class="fa fa-check"></i><b>6.4</b> Aggregating raster to vector cubes</a></li>
<li class="chapter" data-level="6.5" data-path="datacube.html"><a href="datacube.html#switching"><i class="fa fa-check"></i><b>6.5</b> Switching dimension with attributes</a></li>
<li class="chapter" data-level="6.6" data-path="datacube.html"><a href="datacube.html#otherdynamic"><i class="fa fa-check"></i><b>6.6</b> Other dynamic data</a></li>
<li class="chapter" data-level="6.7" data-path="datacube.html"><a href="datacube.html#exercises-5"><i class="fa fa-check"></i><b>6.7</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II R for Spatial Data Science</b></span></li>
<li class="chapter" data-level="7" data-path="sf.html"><a href="sf.html"><i class="fa fa-check"></i><b>7</b> Introduction to sf and stars</a><ul>
<li class="chapter" data-level="7.1" data-path="sf.html"><a href="sf.html#sfintro"><i class="fa fa-check"></i><b>7.1</b> Package <code>sf</code></a></li>
<li class="chapter" data-level="7.2" data-path="sf.html"><a href="sf.html#spatial-joins"><i class="fa fa-check"></i><b>7.2</b> Spatial joins</a></li>
<li class="chapter" data-level="7.3" data-path="sf.html"><a href="sf.html#package-stars"><i class="fa fa-check"></i><b>7.3</b> Package <code>stars</code></a></li>
<li class="chapter" data-level="7.4" data-path="sf.html"><a href="sf.html#vector-data-cube-examples"><i class="fa fa-check"></i><b>7.4</b> Vector data cube examples</a></li>
<li class="chapter" data-level="7.5" data-path="sf.html"><a href="sf.html#raster-to-vector"><i class="fa fa-check"></i><b>7.5</b> raster-to-vector, vector-to-raster</a></li>
<li class="chapter" data-level="7.6" data-path="sf.html"><a href="sf.html#projsf"><i class="fa fa-check"></i><b>7.6</b> Coordinate transformations and conversions</a></li>
<li class="chapter" data-level="7.7" data-path="sf.html"><a href="sf.html#warp"><i class="fa fa-check"></i><b>7.7</b> transforming and warping rasters</a></li>
<li class="chapter" data-level="7.8" data-path="sf.html"><a href="sf.html#exercises-6"><i class="fa fa-check"></i><b>7.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="large.html"><a href="large.html"><i class="fa fa-check"></i><b>8</b> Large data sets</a><ul>
<li class="chapter" data-level="8.1" data-path="large.html"><a href="large.html#largesf"><i class="fa fa-check"></i><b>8.1</b> Vector data: <code>sf</code></a></li>
<li class="chapter" data-level="8.2" data-path="large.html"><a href="large.html#raster-data-stars"><i class="fa fa-check"></i><b>8.2</b> Raster data: <code>stars</code></a></li>
<li class="chapter" data-level="8.3" data-path="large.html"><a href="large.html#very-large-data-cubes"><i class="fa fa-check"></i><b>8.3</b> Very large data cubes</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i><b>9</b> Plotting spatial data</a><ul>
<li class="chapter" data-level="9.1" data-path="plotting.html"><a href="plotting.html#transform"><i class="fa fa-check"></i><b>9.1</b> Every plot is a projection</a></li>
<li class="chapter" data-level="9.2" data-path="plotting.html"><a href="plotting.html#plotting-points-lines-polygons-grid-cells"><i class="fa fa-check"></i><b>9.2</b> Plotting points, lines, polygons, grid cells</a></li>
<li class="chapter" data-level="9.3" data-path="plotting.html"><a href="plotting.html#base-plot"><i class="fa fa-check"></i><b>9.3</b> Base <code>plot</code></a></li>
<li class="chapter" data-level="9.4" data-path="plotting.html"><a href="plotting.html#maps-with-ggplot2"><i class="fa fa-check"></i><b>9.4</b> Maps with <code>ggplot2</code></a></li>
<li class="chapter" data-level="9.5" data-path="plotting.html"><a href="plotting.html#tmap"><i class="fa fa-check"></i><b>9.5</b> Maps with <code>tmap</code></a></li>
<li class="chapter" data-level="9.6" data-path="plotting.html"><a href="plotting.html#interactive-maps-leaflet-mapview-tmap"><i class="fa fa-check"></i><b>9.6</b> Interactive maps: <code>leaflet</code>, <code>mapview</code>, <code>tmap</code></a></li>
</ul></li>
<li class="part"><span><b>III Models for Spatial Data</b></span></li>
<li class="chapter" data-level="10" data-path="statistical-modelling-of-spatial-data.html"><a href="statistical-modelling-of-spatial-data.html"><i class="fa fa-check"></i><b>10</b> Statistical modelling of spatial data</a><ul>
<li class="chapter" data-level="10.1" data-path="statistical-modelling-of-spatial-data.html"><a href="statistical-modelling-of-spatial-data.html#design"><i class="fa fa-check"></i><b>10.1</b> Design-based and model-based inference</a></li>
<li class="chapter" data-level="10.2" data-path="statistical-modelling-of-spatial-data.html"><a href="statistical-modelling-of-spatial-data.html#predictive-models-with-coordinates"><i class="fa fa-check"></i><b>10.2</b> Predictive models with coordinates</a></li>
<li class="chapter" data-level="10.3" data-path="statistical-modelling-of-spatial-data.html"><a href="statistical-modelling-of-spatial-data.html#model-based-inference"><i class="fa fa-check"></i><b>10.3</b> Model-based inference</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="pointpatterns.html"><a href="pointpatterns.html"><i class="fa fa-check"></i><b>11</b> Point Pattern Analysis</a></li>
<li class="chapter" data-level="12" data-path="interpolation.html"><a href="interpolation.html"><i class="fa fa-check"></i><b>12</b> Interpolation and Geostatistics</a><ul>
<li class="chapter" data-level="12.1" data-path="interpolation.html"><a href="interpolation.html#preparing-the-air-quality-dataset"><i class="fa fa-check"></i><b>12.1</b> Preparing the air quality dataset</a></li>
<li class="chapter" data-level="12.2" data-path="interpolation.html"><a href="interpolation.html#sample-variogram"><i class="fa fa-check"></i><b>12.2</b> Sample variogram</a></li>
<li class="chapter" data-level="12.3" data-path="interpolation.html"><a href="interpolation.html#fitting-variogram-models"><i class="fa fa-check"></i><b>12.3</b> Fitting variogram models</a></li>
<li class="chapter" data-level="12.4" data-path="interpolation.html"><a href="interpolation.html#kriging"><i class="fa fa-check"></i><b>12.4</b> Kriging interpolation</a></li>
<li class="chapter" data-level="12.5" data-path="interpolation.html"><a href="interpolation.html#blockkriging"><i class="fa fa-check"></i><b>12.5</b> Areal means: block kriging</a></li>
<li class="chapter" data-level="12.6" data-path="interpolation.html"><a href="interpolation.html#conditional-simulation"><i class="fa fa-check"></i><b>12.6</b> Conditional simulation</a></li>
<li class="chapter" data-level="12.7" data-path="interpolation.html"><a href="interpolation.html#trend-models"><i class="fa fa-check"></i><b>12.7</b> Trend models</a></li>
<li class="chapter" data-level="12.8" data-path="interpolation.html"><a href="interpolation.html#multivariable-geostatistics"><i class="fa fa-check"></i><b>12.8</b> Multivariable geostatistics</a></li>
<li class="chapter" data-level="12.9" data-path="interpolation.html"><a href="interpolation.html#spatiotemporal-interpolation"><i class="fa fa-check"></i><b>12.9</b> Spatiotemporal interpolation</a></li>
<li class="chapter" data-level="12.10" data-path="interpolation.html"><a href="interpolation.html#atpk"><i class="fa fa-check"></i><b>12.10</b> Area-to-point kriging</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="area.html"><a href="area.html"><i class="fa fa-check"></i><b>13</b> Area Data and Spatial Autocorrelation</a><ul>
<li class="chapter" data-level="13.1" data-path="area.html"><a href="area.html#spatial-autocorrelation"><i class="fa fa-check"></i><b>13.1</b> Spatial autocorrelation</a></li>
<li class="chapter" data-level="13.2" data-path="area.html"><a href="area.html#spatial-weight-matrices"><i class="fa fa-check"></i><b>13.2</b> Spatial weight matrices</a></li>
<li class="chapter" data-level="13.3" data-path="area.html"><a href="area.html#measures-of-spatial-autocorrelation"><i class="fa fa-check"></i><b>13.3</b> Measures of spatial autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="spatial-regression.html"><a href="spatial-regression.html"><i class="fa fa-check"></i><b>14</b> Spatial Regression</a><ul>
<li class="chapter" data-level="14.1" data-path="spatial-regression.html"><a href="spatial-regression.html#spatial-regression-with-spatial-weights"><i class="fa fa-check"></i><b>14.1</b> Spatial regression with spatial weights</a></li>
<li class="chapter" data-level="14.2" data-path="spatial-regression.html"><a href="spatial-regression.html#estimators"><i class="fa fa-check"></i><b>14.2</b> Estimators</a></li>
<li class="chapter" data-level="14.3" data-path="spatial-regression.html"><a href="spatial-regression.html#implementation-details"><i class="fa fa-check"></i><b>14.3</b> Implementation details</a></li>
<li class="chapter" data-level="14.4" data-path="spatial-regression.html"><a href="spatial-regression.html#markov-random-field-and-multilevel-models-with-spatial-weights"><i class="fa fa-check"></i><b>14.4</b> Markov random field and multilevel models with spatial weights</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="sp-and-raster.html"><a href="sp-and-raster.html"><i class="fa fa-check"></i><b>15</b> sp and raster</a><ul>
<li class="chapter" data-level="15.1" data-path="sp-and-raster.html"><a href="sp-and-raster.html#links-and-differences-between-sf-and-sp"><i class="fa fa-check"></i><b>15.1</b> links and differences between sf and sp</a></li>
<li class="chapter" data-level="15.2" data-path="sp-and-raster.html"><a href="sp-and-raster.html#migration-packages"><i class="fa fa-check"></i><b>15.2</b> migration packages</a></li>
<li class="chapter" data-level="15.3" data-path="sp-and-raster.html"><a href="sp-and-raster.html#raster-stars-and-sf"><i class="fa fa-check"></i><b>15.3</b> raster, stars and sf</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="all-r-code-in-this-book.html"><a href="all-r-code-in-this-book.html"><i class="fa fa-check"></i>All R code in this book</a></li>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i>R basics</a><ul>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html#pipes"><i class="fa fa-check"></i>Pipes</a></li>
<li class="chapter" data-level="15.4" data-path="r-basics.html"><a href="r-basics.html#data-structures"><i class="fa fa-check"></i><b>15.4</b> Data structures</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intro" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Getting Started</h1>
<p>This chapter introduces a number of concepts associated with
handling spatial data, and points forward to later sections where
they are discussed in more detail.</p>
<p>The code sections in this chapter are not explained, but can be
unfolded by clicking on the “code” button. They should be easy
to follow when understanding R at the level of, say, <a href="http://r4ds.had.co.nz/">R for Data
Science</a> <span class="citation">(Wickham and Grolemund <a href="#ref-r4ds">2017</a>)</span>. Detailed explanation
of R code starts in Part II of this book.</p>
<div id="a-first-map" class="section level2">
<h2><span class="header-section-number">1.1</span> A first map</h2>
<p>The typical way to graph spatial data is by creating a map. Let us consider
a simple map, shown in figure <a href="intro.html#fig:first-map">1.1</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">system.file</span>(<span class="st">&quot;gpkg/nc.gpkg&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>) <span class="op">|</span><span class="er">&gt;</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="st">    </span><span class="kw">read_sf</span>() -&gt;<span class="st"> </span>nc</a>
<a class="sourceLine" id="cb1-5" title="5">nc<span class="fl">.32119</span> &lt;-<span class="st"> </span><span class="kw">st_transform</span>(nc, <span class="dv">32119</span>)</a>
<a class="sourceLine" id="cb1-6" title="6">nc<span class="fl">.32119</span> <span class="op">|</span><span class="er">&gt;</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="st">    </span><span class="kw">select</span>(BIR74) <span class="op">|</span><span class="er">&gt;</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="st">    </span><span class="kw">plot</span>(<span class="dt">graticule =</span> <span class="ot">TRUE</span>, <span class="dt">axes =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:first-map"></span>
<img src="sds_files/figure-html/first-map-1.png" alt="a first map" width="672" />
<p class="caption">
Figure 1.1: a first map
</p>
</div>
<p>A number of graphical elements are present here, in this case:</p>
<ul>
<li>polygons are drawn with a black outline and filled with colors chosen according to a variable <code>BIR74</code>, whose name is in the title</li>
<li>a legend key explains the meaning of the colors, and has a certain <em>color palette</em> and <em>color
breaks</em>, values at which color changes</li>
<li>the background of the map shows curved lines with constant latitude or longitude (graticule)</li>
<li>the axis ticks show the latitude and longitude values</li>
</ul>
<p><em>Polygons</em> are a particular form of <em>geometry</em>; spatial geometries
(points, lines, polygons, pixels) are discussed in detail in
chapter <a href="geometries.html#geometries">3</a>. Polygons consist of sequences of points,
connected by straight lines. How point locations of spatial data are
expressed, or measured, is discussed in chapter <a href="cs.html#cs">2</a>. As can
be seen from figure <a href="intro.html#fig:first-map">1.1</a>, lines of equal latitude
and longitude do not form straight lines, indicating that some
form of projection took place before plotting; projections are also
discussed in chapter <a href="cs.html#cs">2</a> and section <a href="plotting.html#transform">9.1</a>.</p>
<p>The color values in figure <a href="intro.html#fig:first-map">1.1</a> are derived
from numeric values of a variable, <code>BIR74</code>, which has a
single value associated with each geometry or <em>feature</em>. Chapter
<a href="featureattributes.html#featureattributes">5</a> discusses such feature attributes, and the
way they can relate to feature geometries. In this case, <code>BIR74</code>
refers to birth counts, meaning counts <em>over the region</em>. This
implies that the count does not refer to a value associated with
every point inside the polygon, which the continuous color might
suggest, but rather measures an integral (sum) over the polygon.</p>
<p>Before plotting figure <a href="intro.html#fig:first-map">1.1</a> we had to read the data,
in this case from a file (section <a href="sf.html#sfintro">7.1</a>). Printing a data
summary for the first three records of three attribute variables
shows:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">nc <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span><span class="kw">select</span>(AREA, BIR74, SID74) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code># Simple feature collection with 100 features and 3 fields
# Geometry type: MULTIPOLYGON
# Dimension:     XY
# Bounding box:  xmin: -84.3 ymin: 33.9 xmax: -75.5 ymax: 36.6
# Geodetic CRS:  NAD27
# # A tibble: 100 x 4
#    AREA BIR74 SID74                                                         geom
#   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;                                           &lt;MULTIPOLYGON [°]&gt;
# 1 0.114  1091     1 (((-81.5 36.2, -81.5 36.3, -81.6 36.3, -81.6 36.3, -81.7 36…
# 2 0.061   487     0 (((-81.2 36.4, -81.2 36.4, -81.3 36.4, -81.3 36.4, -81.3 36…
# 3 0.143  3188     5 (((-80.5 36.2, -80.5 36.3, -80.5 36.3, -80.5 36.3, -80.6 36…
# # … with 97 more rows</code></pre>
<p>The printed output shows</p>
<ul>
<li>the (selected) dataset has 100 features (records) and 3 fields (attributes)</li>
<li>the geometry type is <code>MULTIPOLYGON</code> (chapter <a href="geometries.html#geometries">3</a>)</li>
<li>it has dimension <code>XY</code>, indicating that each point will consist of 2 coordinate values</li>
<li>the range of x and y values of the geometry</li>
<li>the coordinate reference system (CRS) is geodetic, with coordinates in degrees longitude and latitude associated to the <code>NAD27</code> datum (chapter <a href="cs.html#cs">2</a>)</li>
<li>the three selected attribute variables are followed by a variable <code>geom</code> of type <code>MULTIPOLYGON</code> with unit degrees that contains the polygon information</li>
</ul>
<p>More complicated plots can involve facet plots with a map in each
facet, as shown in figure <a href="intro.html#fig:firstgather">1.2</a>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">year_labels =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;SID74&quot;</span> =<span class="st"> &quot;1974 - 1978&quot;</span>, <span class="st">&quot;SID79&quot;</span> =<span class="st"> &quot;1979 - 1984&quot;</span>)</a>
<a class="sourceLine" id="cb4-2" title="2">nc<span class="fl">.32119</span> <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span><span class="kw">select</span>(SID74, SID79) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span><span class="kw">gather</span>(VAR, SID, <span class="op">-</span>geom) -&gt;<span class="st"> </span>nc2</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> nc2, <span class="kw">aes</span>(<span class="dt">fill =</span> SID)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>VAR, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">labeller =</span> <span class="kw">labeller</span>(<span class="dt">VAR =</span> year_labels)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="dv">34</span><span class="op">:</span><span class="dv">36</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colors =</span> <span class="kw">sf.colors</span>(<span class="dv">20</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:firstgather"></span>
<img src="sds_files/figure-html/firstgather-1.png" alt="ggplot with facet maps" width="672" />
<p class="caption">
Figure 1.2: ggplot with facet maps
</p>
</div>
<p>An interactive, leaflet-based map is obtained in figure <a href="#fig:mapviewfigure"><strong>??</strong></a>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(mapview))</a>
<a class="sourceLine" id="cb5-2" title="2">nc<span class="fl">.32119</span> <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span><span class="kw">mapview</span>(<span class="dt">zcol =</span> <span class="st">&quot;BIR74&quot;</span>, <span class="dt">legend =</span> <span class="ot">TRUE</span>, <span class="dt">col.regions =</span> sf.colors)</a></code></pre></div>
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addFlatGeoBuf","args":["nc_32119-BIR74","nc.32119 - BIR74",null,true,"BIR74",{"radius":6,"stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":null,"fillOpacity":0.6},{"className":"","pane":"polygon"},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-84.3237734918342,33.8821646134545,-75.4565804266542,36.5897678621411,"nc.32119 - BIR74","Zoom to nc.32119 - BIR74","<strong> nc.32119 - BIR74 <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"nc.32119 - BIR74",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#0000B3 , #4500FF 22.2680412371134%, #CC2CD3 45.6982193064667%, #FF837C 69.1283973758201%, #FFDA26 92.5585754451734%, #FFF50A "],"labels":["5,000","10,000","15,000","20,000"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"numeric","title":"nc.32119 - BIR74","extra":{"p_1":0.222680412371134,"p_n":0.925585754451734},"layerId":null,"className":"info legend","group":"nc.32119 - BIR74"}]}],"fitBounds":[33.8821646134545,-84.3237734918342,36.5897678621411,-75.4565804266542,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
<div id="coordinate-reference-systems" class="section level2">
<h2><span class="header-section-number">1.2</span> Coordinate reference systems</h2>
<p>In figure <a href="intro.html#fig:first-map">1.1</a>, the grey lines denote the
<em>graticule</em>, a grid with lines along constant latitude
or longitude. Clearly, these lines are not straight, which
indicates that a <em>projection</em> of the data was used for which the
x and y axis do not align with longitude and latitude. In figure
<a href="#fig:mapviewfigure"><strong>??</strong></a> we see that the north boundary of North
Carolina is plotted as a straight line again, indicating that
another projection was used.</p>
<p>The ellipsoidal coordinates of the graticule of figure
<a href="intro.html#fig:first-map">1.1</a> are associated with a particular <em>datum</em>
(here: NAD27), which implicates a set of rules what the shape of the
Earth is and how it is attached to the Earth (to which point of the
Earth is the origin associated, and how is it directed). If one
would measure coordinates with a GPS device (e.g. a mobile phone)
it would typically report coordinates associated with the WGS84
datum, which can be around 30 m different from the identical
coordinate values when associated with NAD27.</p>
<p>Projections describe how we go back and forth between</p>
<ul>
<li><p><strong>ellipsoidal coordinates</strong> which are expressed as degrees
latitude and longitude, pointing to locations on a shape
approximating the Earth’s shape (an ellipsoid or spheroid), and</p></li>
<li><p><strong>projected coordinates</strong> which are coordinates on a flat,
two-dimensional coordinate system, used when plotting maps.</p></li>
</ul>
<p>Datums transformations are associated with moving from one datum
to another. Both topics are covered by <em>spatial reference systems</em>
are described in more detail in chapter <a href="cs.html#cs">2</a>.</p>
</div>
<div id="rasterize" class="section level2">
<h2><span class="header-section-number">1.3</span> Raster and vector data</h2>
<p>Polygon, point and line geometries are examples of <em>vector</em> data:
point coordinates describe the “exact” locations that can be
anywhere. Raster data on the other hand describe data where values
are aligned on a <em>raster</em>, meaning on a regularly laid out lattice of
usually square pixels. An example is shown in figure <a href="intro.html#fig:ras">1.3</a>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">library</span>(stars)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb6-4" title="4">tif &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;tif/L7_ETMs.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;stars&quot;</span>)</a>
<a class="sourceLine" id="cb6-5" title="5">x &lt;-<span class="st"> </span><span class="kw">read_stars</span>(tif)[,,,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb6-6" title="6"><span class="kw">image</span>(x, <span class="dt">main =</span> <span class="st">&quot;(a)&quot;</span>)</a>
<a class="sourceLine" id="cb6-7" title="7"><span class="kw">image</span>(x[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>], <span class="dt">text_values =</span> <span class="ot">TRUE</span>, <span class="dt">border =</span> <span class="st">&#39;grey&#39;</span>, <span class="dt">main =</span> <span class="st">&quot;(b)&quot;</span>)</a>
<a class="sourceLine" id="cb6-8" title="8"><span class="kw">image</span>(x, <span class="dt">main =</span> <span class="st">&quot;(c)&quot;</span>)</a>
<a class="sourceLine" id="cb6-9" title="9"><span class="kw">set.seed</span>(<span class="dv">131</span>)</a>
<a class="sourceLine" id="cb6-10" title="10">pts =<span class="st"> </span><span class="kw">st_sample</span>(<span class="kw">st_as_sfc</span>(<span class="kw">st_bbox</span>(x)), <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb6-11" title="11"><span class="kw">plot</span>(pts, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">pch =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</a>
<a class="sourceLine" id="cb6-12" title="12"><span class="kw">image</span>(x, <span class="dt">main =</span> <span class="st">&quot;(d)&quot;</span>)</a>
<a class="sourceLine" id="cb6-13" title="13"><span class="kw">plot</span>(<span class="kw">st_buffer</span>(pts, <span class="dv">500</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">pch =</span> <span class="dv">3</span>, <span class="dt">border =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:ras"></span>
<img src="sds_files/figure-html/ras-1.png" alt="raster maps: Landsat-7 blue band, with color values derived from data values (a), the top-left 10x10 sub-image from (a) with numeric values shown (b), and overlayed by two different types of vector data: three sample points (c), and a 500m radius around the points represented as polygons (d)" width="672" />
<p class="caption">
Figure 1.3: raster maps: Landsat-7 blue band, with color values derived from data values (a), the top-left 10x10 sub-image from (a) with numeric values shown (b), and overlayed by two different types of vector data: three sample points (c), and a 500m radius around the points represented as polygons (d)
</p>
</div>
<p>Vector and raster data can be combined in different ways; for instance we can query the raster at the three points of figure <a href="intro.html#fig:ras">1.3</a>(c),</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">st_extract</span>(x, pts)</a></code></pre></div>
<pre><code># Simple feature collection with 3 features and 1 field
# Geometry type: POINT
# Dimension:     XY
# Bounding box:  xmin: 290000 ymin: 9110000 xmax: 292000 ymax: 9120000
# Projected CRS: UTM Zone 25, Southern Hemisphere
#   L7_ETMs.tif               geometry
# 1          80 POINT (290830 9114499)
# 2          58 POINT (290019 9119219)
# 3          63 POINT (291693 9116038)</code></pre>
<p>or compute an aggregate, such as the average, over arbitrary regions such as the circles shown in figure <a href="intro.html#fig:ras">1.3</a>(d):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">aggregate</span>(x, <span class="kw">st_buffer</span>(pts, <span class="dv">500</span>), <span class="dt">FUN =</span> mean) <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span><span class="kw">st_as_sf</span>()</a></code></pre></div>
<pre><code># Simple feature collection with 3 features and 1 field
# Geometry type: POLYGON
# Dimension:     XY
# Bounding box:  xmin: 290000 ymin: 9110000 xmax: 292000 ymax: 9120000
# Projected CRS: UTM Zone 25, Southern Hemisphere
#     V1                       geometry
# 1 77.2 POLYGON ((291330 9114499, 2...
# 2 60.1 POLYGON ((290519 9119219, 2...
# 3 71.6 POLYGON ((292193 9116038, 2...</code></pre>
<p>Other raster-to-vector conversions are discussed in <a href="sf.html#raster-to-vector">7.5</a> and include</p>
<ul>
<li>converting raster pixels in point values</li>
<li>converting raster pixels into small polygons, possibly merging polygons with identical values (“polygonize”)</li>
<li>generating lines or polygons that delineate continuous pixel areas with a certain value <em>range</em> (“contour”)</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">plot</span>(<span class="kw">st_rasterize</span>(nc[<span class="st">&quot;BIR74&quot;</span>], <span class="dt">dx =</span> <span class="fl">0.1</span>), <span class="dt">col =</span><span class="kw">sf.colors</span>(), <span class="dt">breaks =</span> <span class="st">&quot;equal&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:vectoras"></span>
<img src="sds_files/figure-html/vectoras-1.png" alt="The map obtained by rasterizing county total number of births for the period 1974-1979  shown in figure 1.1" width="672" />
<p class="caption">
Figure 1.4: The map obtained by rasterizing county total number of births for the period 1974-1979 shown in figure 1.1
</p>
</div>
<p>Vector-to-raster conversions can be as simple as rasterizing
polygons, as shown in figure <a href="intro.html#fig:vectoras">1.4</a>. Other, more
general vector-to-raster conversions that may involve statistical
modelling include</p>
<ul>
<li>interpolation of point values to points on a regular grid (chapter <a href="interpolation.html#interpolation">12</a>)</li>
<li>estimating densities of points over a regular grid (chapter <a href="pointpatterns.html#pointpatterns">11</a>)</li>
<li>area-weighted interpolation of polygon values to grid cells (section <a href="featureattributes.html#area-weighted">5.3</a>)</li>
<li>direct rasterization of points, lines or polygons (section <a href="sf.html#raster-to-vector">7.5</a>)</li>
</ul>
</div>
<div id="raster-types" class="section level2">
<h2><span class="header-section-number">1.4</span> Raster types</h2>
<p>Raster dimensions describe how the rows and columns relate to
spatial coordinates. Figure <a href="intro.html#fig:rastertypes01">1.5</a> shows a number
of different possibilities.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">x =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span></a>
<a class="sourceLine" id="cb12-2" title="2">y =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb12-3" title="3">d =<span class="st"> </span><span class="kw">st_dimensions</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">.raster =</span> <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>))</a>
<a class="sourceLine" id="cb12-4" title="4">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">20</span>),<span class="dv">5</span>,<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb12-5" title="5">r1 =<span class="st"> </span><span class="kw">st_as_stars</span>(<span class="dt">r =</span> m, <span class="dt">dimensions =</span> d)</a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7">r =<span class="st"> </span><span class="kw">attr</span>(d, <span class="st">&quot;raster&quot;</span>)</a>
<a class="sourceLine" id="cb12-8" title="8">r<span class="op">$</span>affine =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">-0.2</span>)</a>
<a class="sourceLine" id="cb12-9" title="9"><span class="kw">attr</span>(d, <span class="st">&quot;raster&quot;</span>) =<span class="st"> </span>r</a>
<a class="sourceLine" id="cb12-10" title="10">r2 =<span class="st"> </span><span class="kw">st_as_stars</span>(<span class="dt">r =</span> m, <span class="dt">dimensions =</span> d)</a>
<a class="sourceLine" id="cb12-11" title="11"></a>
<a class="sourceLine" id="cb12-12" title="12">r =<span class="st"> </span><span class="kw">attr</span>(d, <span class="st">&quot;raster&quot;</span>)</a>
<a class="sourceLine" id="cb12-13" title="13">r<span class="op">$</span>affine =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">-0.3</span>)</a>
<a class="sourceLine" id="cb12-14" title="14"><span class="kw">attr</span>(d, <span class="st">&quot;raster&quot;</span>) =<span class="st"> </span>r</a>
<a class="sourceLine" id="cb12-15" title="15">r3 =<span class="st"> </span><span class="kw">st_as_stars</span>(<span class="dt">r =</span> m, <span class="dt">dimensions =</span> d)</a>
<a class="sourceLine" id="cb12-16" title="16"></a>
<a class="sourceLine" id="cb12-17" title="17">x =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">3.5</span>, <span class="dv">5</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb12-18" title="18">y =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">3</span>, <span class="fl">3.5</span>)</a>
<a class="sourceLine" id="cb12-19" title="19">d =<span class="st"> </span><span class="kw">st_dimensions</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">.raster =</span> <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>))</a>
<a class="sourceLine" id="cb12-20" title="20">r4 =<span class="st"> </span><span class="kw">st_as_stars</span>(<span class="dt">r =</span> m, <span class="dt">dimensions =</span> d)</a>
<a class="sourceLine" id="cb12-21" title="21"></a>
<a class="sourceLine" id="cb12-22" title="22">grd =<span class="st"> </span><span class="kw">st_make_grid</span>(<span class="dt">cellsize =</span> <span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">10</span>), <span class="dt">offset =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">130</span>,<span class="dv">10</span>), <span class="dt">n=</span> <span class="kw">c</span>(<span class="dv">8</span>,<span class="dv">5</span>), <span class="dt">crs=</span><span class="kw">st_crs</span>(<span class="dv">4326</span>))</a>
<a class="sourceLine" id="cb12-23" title="23">r5 =<span class="st"> </span><span class="kw">st_transform</span>(grd, <span class="st">&quot;+proj=laea +lon_0=-70 +lat_0=35&quot;</span>)</a>
<a class="sourceLine" id="cb12-24" title="24"></a>
<a class="sourceLine" id="cb12-25" title="25"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="fl">1.1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb12-26" title="26">r1 =<span class="st"> </span><span class="kw">st_make_grid</span>(<span class="dt">cellsize =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">4</span>), <span class="dt">offset =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb12-27" title="27"><span class="kw">plot</span>(r1, <span class="dt">main =</span> <span class="st">&quot;regular&quot;</span>)</a>
<a class="sourceLine" id="cb12-28" title="28"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(<span class="kw">st_as_sf</span>(r2)), <span class="dt">main =</span> <span class="st">&quot;rotated&quot;</span>)</a>
<a class="sourceLine" id="cb12-29" title="29"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(<span class="kw">st_as_sf</span>(r3)), <span class="dt">main =</span> <span class="st">&quot;sheared&quot;</span>)</a>
<a class="sourceLine" id="cb12-30" title="30"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(<span class="kw">st_as_sf</span>(r4, <span class="dt">as_points =</span> <span class="ot">FALSE</span>)), <span class="dt">main =</span> <span class="st">&quot;rectilinear&quot;</span>)</a>
<a class="sourceLine" id="cb12-31" title="31"><span class="kw">plot</span>(<span class="kw">st_geometry</span>((r5)), <span class="dt">main =</span> <span class="st">&quot;curvilinear&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:rastertypes01"></span>
<img src="sds_files/figure-html/rastertypes01-1.png" alt="various raster types" width="672" />
<p class="caption">
Figure 1.5: various raster types
</p>
</div>
<p>Regular rasters like shown in figure <a href="intro.html#fig:rastertypes01">1.5</a> have a constant,
not necessarily square cell size and axes aligned with the x and y
(Easting and Northing) axes. Other raster types include those
where the axes are no longer aligned with x and y (<em>rotated</em>),
where axes are no longer perpendicular (<em>sheared</em>), or where cell
size varies along a dimension (<em>rectilinear</em>). Finally, <em>curvilinear</em>
rasters have cellsize and/or direction properties that are no longer
independent from the other raster dimension.</p>
<p>When a raster that is regular in a given coordinate reference
system is projected to another raster while keeping each raster
cell in tact, it changes shape and may become rectilinear
(e.g. when going from ellipsoidal coordinates to Mercator, as in
figure <a href="#fig:mapviewfigure"><strong>??</strong></a>) or curvilinear (e.g. when going from
ellipsoidal coordinates to Lambert Conic Conformal, as in figure
<a href="intro.html#fig:first-map">1.1</a>). When reverting this procedure, one can recover
the exact original raster.</p>
<p>Creating a new, regular grid in the new projection is called raster
(or image) <em>reprojection</em> or <em>warping</em> (section <a href="sf.html#warp">7.7</a>). This
process is lossy, irreversible, and may need to be informed whether
raster cells should be interpolated, averaged or summed, whether
they denote categorical variables, or whether resampling using
nearest neighbours should be used; see also section <a href="intro.html#support">1.6</a>.</p>
</div>
<div id="time-series-arrays-data-cubes" class="section level2">
<h2><span class="header-section-number">1.5</span> Time series, arrays, data cubes</h2>
<p>A lot of spatial data is not <em>just</em> spatial, but in addition temporal. Just like any observation is associated with an observation location, it is associated with an observation time or period. The dataset on the North Carolina counties shown above contains disease cases counted over two time periods, shown in figure <a href="intro.html#fig:firstgather">1.2</a>. Although the original dataset has these variables in two different columns, for plotting them these columns had to be stacked first, while repeating the associated geometries - a form called <em>tidy</em> by <span class="citation">(Wickham <a href="#ref-tidy">2014</a><a href="#ref-tidy">b</a>)</span>. When we have longer time series associated with geometries, neither option - distributing time over multiple columns, or stacking columns while repeating geometries - works well, and a more effective way of storing such data would be a matrix or array, where one dimension refers to time, and the other(s) to space. The natural way for image or raster data is already to store them in matrices; time series of rasters then lead to a three-dimensional array. The general term for such data is a (spatiotemporal) <strong>data cube</strong>, where cube refers to arrays with any number of dimensions. Data cubes can refer to both raster and vector data, examples are given in chapter <a href="datacube.html#datacube">6</a>.</p>
</div>
<div id="support" class="section level2">
<h2><span class="header-section-number">1.6</span> Support</h2>
<p>When we have spatial data with geometries that are not points but
collections of points (multi-points, lines, polygons, pixels),
then the attributes associated with these geometries has one
of several different relationships to them. Attributes can have</p>
<ul>
<li>a <strong>constant</strong> value for every point of the geometry</li>
<li>a value that is unique to only this geometry, describing its <strong>identity</strong></li>
<li>a single value that is an <strong>aggregate</strong> over all points of the geometry</li>
</ul>
<p>An example of a constant is land use or bedrock type of a polygon. An
example of an identity is a county name. An example of an aggregate
is the number of births over a given period of time, of a county.</p>
<p>The area with to which an attribute value refers to is called its
<strong>support</strong>: aggregate properties have “block” (or polygon, or line)
support, constant properties have “point” support (they apply to
every point). Support matters when we manipulate the data. For
instance, figure <a href="intro.html#fig:vectoras">1.4</a> was derived from a variable that has
polygon support: the number of births per county. Rasterizing these
values gives pixels with values that are associated to counties.
The result of the rasterization is a meaningless map: the numeric
values (“birth totals”) are not associated with the raster cells,
and the county boundaries are no longer present. Totals of birth for
the whole state can no longer be recovered from the pixel values.
Ignoring support can easily lead to meaningless results. Chapter
<a href="featureattributes.html#featureattributes">5</a> discusses this further.</p>
<p>Raster cell values may have point support, e.g. when the cell records
the elevation of the point at the cell centre in a digital elevation
model, or cell support, e.g. when a satellite image pixel gives the
color value averaged over (an area similar to the) pixel. Most file
formats do not provide this information, yet it may be important
to know when aggregating, regridding or warping rasters (section
<a href="sf.html#warp">7.7</a>).</p>
</div>
<div id="spatial-data-science-software" class="section level2">
<h2><span class="header-section-number">1.7</span> Spatial data science software</h2>
<p>Although this book largely uses R and R packages for spatial data
science, a number of these packages use software libraries that were
not developed for R specifically. As an example, the dependency
of R package <code>sf</code> on other R packages and system libraries is shown
in figure <a href="intro.html#fig:gdal-fig-nodetails">1.6</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:gdal-fig-nodetails"></span>
<img src="images/sf_deps.png" alt="sf and its dependencies; arrows indicate strong dependency, dashed arrows weak dependency" width="100%" />
<p class="caption">
Figure 1.6: sf and its dependencies; arrows indicate strong dependency, dashed arrows weak dependency
</p>
</div>
<p>The C or C++ libraries used (GDAL, GEOS, PROJ, liblwgeom, s2geometry,
NetCDF, udunits2) are all developed, maintained and used by (spatial)
data science communities that are large and mostly different from
the R community. By using these libraries, R users share how we
understand what we are doing with these other communities. Because R,
Python and Julia provide interactive interfaces to this software,
many users get closer to these libraries than do users of other
software based on these libraries. The first part of this book
describes many of the concepts implemented in these libraries,
which is relevant to spatial data science in general.</p>
<div id="gdal" class="section level3">
<h3><span class="header-section-number">1.7.1</span> GDAL</h3>
<p>GDAL (geospatial data abstraction library) can be seen as the
Swiss army knive of spatial data; besides for R it is being
used in Python, QGIS, PostGIS, <a href="https://trac.osgeo.org/gdal/wiki/SoftwareUsingGdal">and more than 100 other software
projects</a>.</p>
<p>GDAL is a “library of libraries” – in order to read all these data
sources it needs a large number of other libraries. It typically
links to over 100 other libraries, each of which provides access to
e.g. a particular data file format, database access, or web service.</p>
<p>Binary R packages distributed by CRAN contain only statically linked
code: CRAN does not want to make any assumptions about presence
of third-party libraries on the host system. As a consequence,
when the <code>sf</code> package is installed in binary form from CRAN, it
includes a copy of all the required external libraries as well as
their dependencies, which may amount to 100 Mb.</p>
</div>
<div id="proj" class="section level3">
<h3><span class="header-section-number">1.7.2</span> PROJ</h3>
<p>PROJ (or PR<span class="math inline">\(\phi\)</span>J) is a library for cartographic projections
and datum transformations: it converts spatial coordinates
from one coordinate reference system to another. It comes with
a large database of known projections and access to datum grids
(high-precision pre-calculated values for datum transformations). It
aligns with an international standard for coordinate reference
systems <span class="citation">(Lott <a href="#ref-lott2015">2015</a>)</span>. Chapter <a href="cs.html#cs">2</a> deals with coordinate
systems, and PROJ.</p>
</div>
<div id="geos-and-s2geometry" class="section level3">
<h3><span class="header-section-number">1.7.3</span> GEOS and s2geometry</h3>
<p>GEOS (“Geometry Engine Open Source”) and s2geometry are two libraries
for geometric operations. They are used to find measures (length,
area, distance), and calculate predicates (do two geometries have
any points in common?) or new geometries (which points do these two
geometries have in common?). GEOS does this for flat, two-dimensional
space (indicated by <span class="math inline">\(R^2\)</span>), s2geometry does this for geometries on
the sphere (indicated by <span class="math inline">\(S^2\)</span>). Chapter <a href="cs.html#cs">2</a> introduces
coordinate reference systems, and chapter <a href="spherical.html#spherical">4</a> discusses
more about the differences between working with these two spaces.</p>
</div>
<div id="netcdf-udunits2-liblwgeom" class="section level3">
<h3><span class="header-section-number">1.7.4</span> NetCDF, udunits2, liblwgeom</h3>
<p>NetCDF <span class="citation">(UCAR <a href="#ref-netcdf">2020</a>)</span> refers to a file format as well as a C library
for reading and writing NetCDF files. It allows the definition of
arrays of any dimensionality, and is widely used for spatial and
spatiotemporal information, especially in the (climate) modelling
communities. Udunits2 <span class="citation">(UCAR <a href="#ref-udunits2">2014</a>; E. Pebesma et al. <a href="#ref-R-units">2021</a>)</span> is a database and software
library for units of measurement that allows the conversion of
units, handles derived units, and supports user-defined units. The
liblwgeom “library” is a software component of PostGIS <span class="citation">(Obe and Hsu <a href="#ref-postgis">2015</a>)</span>
that contains several routines missing from GDAL or GEOS, including
convenient access to GeographicLib routines <span class="citation">(Karney <a href="#ref-karney2013algorithms">2013</a>)</span>
that ship with PROJ.</p>
</div>
</div>
<div id="exercises" class="section level2">
<h2><span class="header-section-number">1.8</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li>List five differences between raster and vector data.
<!-- 1: regular/irregular coordinates, 2: regular/irregular shaped elements; 3: different file formats: tiff vs. shapefile/GPKG, 4:  --></li>
<li>In addition to those listed below figure <a href="intro.html#fig:first-map">1.1</a>, list five further graphical components that are often found on a map.
<!-- scale bar; North arrow; geographic components used for reference, e.g. coastline, rivers; colored "other" area, e.g. blue sea; symbols; words indicating a region--></li>
<li>In your own words, why is the numeric information shown in figure <a href="intro.html#fig:vectoras">1.4</a> misleading (or meaningless)?
<!-- for the numbers shown as colors, it is unclear with which area they are associated with (counties) --></li>
<li>Under which conditions would you expect strong differences when doing geometrical operations on <span class="math inline">\(S^2\)</span>, compared to doing them on <span class="math inline">\(R^2\)</span>?
<!-- when working with global datasets --></li>
</ol>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-karney2013algorithms">
<p>Karney, Charles FF. 2013. “Algorithms for Geodesics.” <em>Journal of Geodesy</em> 87 (1): 43–55. <a href="https://link.springer.com/content/pdf/10.1007/s00190-012-0578-z.pdf">https://link.springer.com/content/pdf/10.1007/s00190-012-0578-z.pdf</a>.</p>
</div>
<div id="ref-lott2015">
<p>Lott, Roger. 2015. “Geographic Information-Well-Known Text Representation of Coordinate Reference Systems.” Open Geospatial Consortium. <a href=" http://docs.opengeospatial.org/is/12-063r5/12-063r5.html ">http://docs.opengeospatial.org/is/12-063r5/12-063r5.html</a>.</p>
</div>
<div id="ref-postgis">
<p>Obe, Regina O, and Leo S Hsu. 2015. <em>PostGIS in Action</em>. Manning Publications Co.</p>
</div>
<div id="ref-R-units">
<p>Pebesma, Edzer, Thomas Mailund, Tomasz Kalinowski, and Iñaki Ucar. 2021. <em>Units: Measurement Units for R Vectors</em>. <a href="https://github.com/r-quantities/units/">https://github.com/r-quantities/units/</a>.</p>
</div>
<div id="ref-udunits2">
<p>UCAR. 2014. <em>UDUNITS 2.2.26 Manual</em>. <a href="https://www.unidata.ucar.edu/software/udunits/udunits-current/doc/udunits/udunits2.html">https://www.unidata.ucar.edu/software/udunits/udunits-current/doc/udunits/udunits2.html</a>.</p>
</div>
<div id="ref-netcdf">
<p>UCAR. 2020. <em>The Netcdf User’s Guide</em>. <a href="https://www.unidata.ucar.edu/software/netcdf/docs/user_guide.html">https://www.unidata.ucar.edu/software/netcdf/docs/user_guide.html</a>.</p>
</div>
<div id="ref-tidy">
<p>Wickham, Hadley. 2014b. “Tidy Data.” <em>Journal of Statistical Software</em> 59 (1). <a href=" https://www.jstatsoft.org/article/view/v059i10 ">https://www.jstatsoft.org/article/view/v059i10</a>.</p>
</div>
<div id="ref-r4ds">
<p>Wickham, Hadley, and Garret Grolemund. 2017. <em>R for Data Science</em>. O’Reilly. <a href="http://r4ds.had.co.nz/">http://r4ds.had.co.nz/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/edzer/sdsr/edit/master/01-hello.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
